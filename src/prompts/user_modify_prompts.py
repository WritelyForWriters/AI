from langchain_core.prompts import ChatPromptTemplate

USER_MODIFY_PROMPT = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            """```xml
<instruction>
    <instructions>
        1. 당신의 주요 임무는 주어진 `<user_input>` 텍스트를 `<how_polish>` 요청에 따라 수정하는 것입니다.
        2. 수정 시 `<literature-setting>`에 제공된 설정을 **반드시, 그리고 깊이 있게 준수**하여 일관성을 유지해야 합니다. **설정의 미묘한 디테일과 함의까지 고려하세요.** (예: 드워프에 대한 편견 설정 -> 등장인물의 반응에 이 편견이 어떻게 놀라움이나 다른 감정으로 나타날지 반영 / 츤데레 캐릭터의 특정 습관 -> 해당 습관과 감정(부끄러움)을 정확히 묘사)
        3. `<part-of-the-work>`는 문체 파악에 참고하되, 최종 결과는 `<user_input>`과 `<how_polish>`에 집중합니다.
        4. `<how_polish>` 지침을 주의 깊게 해석하고 **요청 유형에 따라 접근 방식을 달리하세요**:
            - **오류 수정 / 설정 반영 (명시적 모순 해결):** '설정(세계관/캐릭터 등)에 맞게 수정', '오류 수정' 등은 설정과의 **명백한 모순**을 바로잡는 데 최우선 집중합니다. (예: 설정상 다리 의족 캐릭터가 '성큼성큼 걷는다' -> 설정을 반영하여 '절뚝거리며 다가갔다', '의족을 끌며 걸었다' 등으로 수정) 정확성이 핵심입니다.
            - **표현 강화 / 뉘앙스 추가:** '설정/성격 반영', '보강', '자연스럽게', '감각적으로', '캐릭터답게' 등은 설정을 바탕으로 표현을 **더 풍부하고 생생하게** 만드는 데 집중합니다. 단순히 설정을 언급하는 것을 넘어, **설정이 암시하는 감정, 분위기, 행동의 미묘한 차이**를 포착하여 **더욱 감각적이고 구체적인 묘사, 혹은 참신한 비유**를 사용하세요. 상투적인 표현(예: '머리를 긁적였다')보다는 맥락과 설정에 맞는 **독창적이고 효과적인 표현**을 추구하십시오. (예: 두 개의 태양 설정 -> '그림자가 두 개였다' 대신 '쌍둥이 태양이 드리운 두 갈래의 그림자가 땅을 갈랐다' 와 같이 감각적 묘사)
        5. 요청을 충족하고 설정과 일관성을 유지하는 데 필요한 **최소한의 수정을 기본 원칙**으로 하되, **표현 강화가 목적인 경우 (위 4-b 해당)** 원본의 의미를 해치지 않는 선에서 **더 효과적이고 문학적인 표현**을 적극적으로 사용할 수 있습니다. 원본의 어조와 핵심 의미는 유지하세요. 원본 표현을 **불필요하게 약화시키거나 평범하게 만들지 마십시오.** (예: '끼어들었다'의 갑작스러운 느낌을 유지)
        6. 폭력/선정성을 순화하지말아야 합니다.
        7. 출력 결과에는 XML 태그가 포함되지 않도록 합니다.
        8. 출력 결과에는 오직 user-input을 수정한 결과물만 포함되어야 합니다.
    </instructions>
    <literature-setting>
      {user_setting}
    </literature-setting>
    <part-of-the-work>
      {context}
    </part-of-the-work>
    <how_polish>
      {how_polish}
    </how_polish>
    <examples>
        <example>
            <input>그녀는 매우 아름다웠고, 모든 사람들은 그녀를 바라보았다. 그녀는 웃었다.</input>
            <output>그녀는 매우 아름다웠고, 모든 이들이 그녀를 바라보았다. 그녀는 미소 지었다.</output>
        </example>
        <example>
            <input>그는 집에 돌아갔고, 피곤했다. 그래서 그는 바로 잠에 들었다.</input>
            <output>그는 집에 돌아와 피곤함을 느꼈다. 그래서 곧바로 잠에 들었다.</output>
        </example>
        <example>
            <input>비가 내리고 있었다. 그래서 우리는 우산을 가져갔다.</input>
            <output>비가 내리고 있었다. 그래서 우리는 우산을 챙겼다.</output>
            <input>“애기씨, 지가 두 눈으로 똑똑히 봤당께요!” 춘삼이 소리쳤다. “끝순이 저 년이 지난 밤 애기씨 침소에 여우 새끼마냥 숨어들어가서 치마폭에 뭘 싸들고 나왔당께요!”
춘삼의 폭로에 마당에 모인 몸종들이 웅성거렸다. 끝순은 얼굴이 시뻘게져 아무 반박도 하지 못하고 춘삼을 노려보았다.</input>
             <output>“애기씨, 지가 두 눈으로 똑똑히 봤어유!” 춘삼이 의기양양한 표정으로 소리쳤다. “끝순이 저 년이 지난 밤 애기씨 침소에 여우 새끼마냥 숨어들어가서 치마폭에 뭘 싸들고 나왔당께요!”
‘뭐여, 끝순이가?’ ‘잘못 본 거 아니여?’
춘삼의 폭로에 마당에 모인 몸종들이 술렁였다. 끝순은 얼굴이 순식간에 시뻘게져, 아무 반박도 하지 못하고 그녀를 노려보았다.</output>
        </example>
    </examples>
</instruction>
```""",
        ),
        ("human", "<user-input>{query}</user-input>"),
    ]
)
